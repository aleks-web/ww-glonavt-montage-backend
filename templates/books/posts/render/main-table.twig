{#
    –†–ï–ê–õ–ò–ó–û–í–ê–¢–¨!!!
    request_params - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
    posts - –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
    posts.{post_element}.department - –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–µ–Ω–∞–¥–ª–µ–∂–∏—Ç –¥–æ–ª–∂–Ω–æ—Å—Ç—å
#}

<div class="content-table">
    <div class="content-table__container">

        {% if posts | length > 0 %}
            <table>
                <thead>
                    <tr>
                        <th class="text-center" width="10%">‚Ññ –ø/–ø</th>
                        <th class="text-start" style="margin-left: 10px">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</th>
                        <th class="text-start" style="margin-left: 10px">–û—Ç–¥–µ–ª</th>
                        <th class="text-start" style="margin-left: 10px">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    </tr>
                </thead>

                <tbody>
                    {% for post in posts %}
                        <tr>
                            <td class="text-center">{{ post.id }}</td>
                            <td class="text-start">{{ post.name }}</td>
                            <td class="text-start">{{ post.department.name }}</td>

                            <td class="text-start">{{ post.description | default('-') }}</td>

                            
                                <td class="td-btn-default">
                                    <svg {% if post.is_delete == false %}style="opacity: 0;cursor: context-menu !important;pointer-events: none;"{% endif %} class="hover" onclick="edit_post({{ post.id }})"><use xlink:href="#svg-edit"></use></svg>
                                </td>

                                <td class="td-btn-default">
                                    <svg {% if post.is_delete == false %}style="opacity: 0;cursor: context-menu !important;pointer-events: none;"{% endif %} class="hover" onclick="delete_post({{ post.id }})"><use xlink:href="#svg-del"></use></svg>
                                </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div style="display: flex; gap: 10px; align-items: center; flex-direction: column; justify-content: center; height: 100%;font-size: 2rem;">
                <span style="font-size: 3rem;">üôÅ</span>
                {% if request_params.control_panel_condition != '' %}
                    <span>–¢–∞–∫–∏—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –Ω–µ –Ω–∞—à–ª–æ—Å—å</span>
                {% else %}
                    <span>–î–æ–ª–∂–Ω–æ—Å—Ç–µ–π –Ω–µ—Ç!</span>
                {% endif %}
                <button data-fancybox data-src="#fmodal-book-new-post" class="btn">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å</button>
            </div>
        {% endif %}

    </div>
</div>


{# Start —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ #}
<script>
    function delete_post(id) {
        let formData = new FormData();
        let url = API_V1_URLS.book_posts.delete;

        formData.append('id', id);

        xpost_fd(url, formData).then(response => {
            let mes = response.message ? response.message : '–£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ (' + url + ')';
            
            dd(response, mes, 'success');
            push(mes, 'success');
            xrender_main_table_book_posts();
        }).catch(response => {
            let mes = response.message ? response.message : '–ù–µ—É–¥–∞—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ (' + url + ')';
            
            dd(response, mes, 'error');
            push(mes, 'error');
        });
    }
</script>
{# End —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ #}

{# Start –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ | –ø–æ–¥–≥—Ä—É–∑–∫–∞ –º–æ–¥–∞–ª–∫–∏ #}
<script>
    function edit_post(id) {
        let url = API_V1_URLS.book_posts.render + 'fmodal-book-post-update';

        $.ajax({
            url: url,
            method: "POST",
            data: {
                id: id,
                twig_element: 'fmodal-book-post-update.twig',
            },
            success: function (response) {
                if (response.status == "success") {

                    $('#fmodal-book-post-update-wrapper').html(response.render_response_html);

                    $.fancybox.open({
                        src: '#fmodal-book-post-update',
                        type: 'inline'
                    });


                    dd_render_success(
                        response,
                        'books/posts/render/fmodal-book-post-update.twig',
                        url
                    );
                }
            }
        });
    }
</script>
{# End –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ | –ø–æ–¥–≥—Ä—É–∑–∫–∞ –º–æ–¥–∞–ª–∫–∏  #}