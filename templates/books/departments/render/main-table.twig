{#
    –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!
    request_params - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
    departments - –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã (–æ—Ç–¥–µ–ª—ã)
#}

<div class="content-table">
    <div class="content-table__container">

        {% if departments | length > 0 %}
            <table>
                <thead>
                    <tr>
                        <th class="text-center" width="10%">‚Ññ –ø/–ø</th>
                        <th class="text-start">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª–∞</th>
                        <th class="text-start">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    </tr>
                </thead>

                <tbody>
                    {% for department in departments %}
                        <tr>
                            <td class="text-center">{{ department.id }}</td>
                            <td class="text-start">{{ department.name }}</td>
                            <td class="text-start">{{ department.description }}</td>
                            
                            <td class="td-btn-default">
                                <svg class="hover" {% if department.is_delete == false %}style="opacity: 0;cursor: context-menu !important;pointer-events: none;"{% endif %} onclick="edit_department({{ department.id }})"><use xlink:href="#svg-edit"></use></svg>
                            </td>
                            <td class="td-btn-default">
                                <svg class="hover" {% if department.is_delete == false %}style="opacity: 0;cursor: context-menu !important;pointer-events: none;"{% endif %}onclick="delete_department({{ department.id }})"><use xlink:href="#svg-del"></use></svg>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div style="display: flex; gap: 10px; align-items: center; flex-direction: column; justify-content: center; height: 100%;font-size: 2rem;">
                <span style="font-size: 3rem;">üôÅ</span>
                
                {% if request_params.control_panel_condition != '' %}
                    <span>–¢–∞–∫–∏—Ö –æ—Ç–¥–µ–ª–æ–≤ –Ω–µ –Ω–∞—à–ª–æ—Å—å</span>
                {% else %}
                    <span>–û—Ç–¥–µ–ª–æ–≤ –Ω–µ—Ç!</span>
                {% endif %}

                <button data-fancybox data-src="#fmodal-book-new-departments" class="btn">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª</button>
            </div>
        {% endif %}

    </div>
</div>


{# Start —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ #}
<script>
    function delete_department(id) {
        let formData = new FormData();

        formData.append('id', id);

        $.ajax({
            url: API_V1_URLS.book_departments.delete,
            method: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {

                if (response.status == "success") {
                    xrender_main_table_book_departments();

                    dd(response, `–û—Ç–¥–µ–ª —É–¥–∞–ª–µ–Ω –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ ${API_V1_URLS.book_departments.delete}`);
                    push(response.message, 'success');
                } else if ('error') {
                    dd(response, response.message ? response.message : `${API_V1_URLS.book_departments.delete}`, 'error');
                    push(response.message, 'error');
                }
            }
        });
    }
</script>
{# End —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ #}

{# Start —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ #}
<script>
    function edit_department(id) {
        let formData = new FormData();
        formData.append('id', id);

        let url = API_V1_URLS.book_departments.render + 'fmodal-book-departments-update';

        $.ajax({
            url: url,
            method: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                if (response.status == "success") {
                    
                    $('#fmodal-book-departments-update-wrapper').html(response.render_response_html);
                    
                    $.fancybox.open({
                        src: '#fmodal-book-departments-update',
                        type: 'inline'
                    });

                    dd_render_success(response, 'fmodal-book-departments-update.twig', url);
                } else if ('error') {
                    dd(response, response.message ? response.message : `${url}`, 'error');
                }
            }
        });
    }
</script>
{# End —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ #}